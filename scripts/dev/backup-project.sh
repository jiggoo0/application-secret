#!/bin/bash

# === CONFIG ===
PROJECT_DIR="$HOME/project"
BACKUP_DIR="$HOME/storage/downloads/Backup"
TIMESTAMP=$(date +"%Y-%m-%d_%H-%M-%S")
ZIP_NAME="project-backup-$TIMESTAMP.zip"

# === EXECUTE ===
if [ ! -d "$PROJECT_DIR" ]; then
  echo "тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣М: $PROJECT_DIR"
  exit 1
fi

cd "$PROJECT_DIR"

echo "ЁЯУж р╕Бр╕│р╕ер╕▒р╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М backup: $ZIP_NAME"
zip -r "$ZIP_NAME" . -x "node_modules/*" "node_modules/**" > /dev/null

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ BACKUP_DIR р╣Ар╕Ыр╣Зр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М р╣Др╕бр╣Ир╣Гр╕Кр╣Ир╣Др╕Яр╕ер╣М
if [ -f "$BACKUP_DIR" ]; then
  echo "тЭМ р╕бр╕╡р╣Др╕Яр╕ер╣Мр╕Кр╕╖р╣Ир╕нр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Ър╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М Backup р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з: $BACKUP_DIR"
  exit 1
fi

# р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡
mkdir -p "$BACKUP_DIR"

echo "ЁЯУБ р╕вр╣Йр╕▓р╕вр╣Др╕Яр╕ер╣Мр╣Др╕Ыр╕вр╕▒р╕З: $BACKUP_DIR"
mv "$ZIP_NAME" "$BACKUP_DIR/" || { echo "тЭМ р╕вр╣Йр╕▓р╕вр╣Др╕Яр╕ер╣Мр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И"; exit 1; }

echo "ЁЯз╣ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╕ер╕Ър╣Др╕Яр╕ер╣Мр╣Ар╕Бр╣Ир╕▓р╣Ар╕Бр╕┤р╕Щ 10 р╕гр╕▓р╕вр╕Бр╕▓р╕г..."
cd "$BACKUP_DIR" || { echo "тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М Backup р╣Др╕Фр╣Й"; exit 1; }

# р╕ер╕Ър╣Др╕Яр╕ер╣М zip р╣Ар╕Бр╕┤р╕Щ 10 р╕Хр╕▒р╕з (р╣Ар╕гр╕╡р╕вр╕Зр╕Ир╕▓р╕Бр╣Гр╕лр╕бр╣Ир╣Др╕Ыр╣Ар╕Бр╣Ир╕▓ р╣Бр╕ер╣Йр╕зр╕ер╕Ър╕Хр╕▒р╕зр╕Чр╕╡р╣Ир╣Ар╕Бр╕┤р╕Щ)
ls -tp *.zip 2>/dev/null | grep -v '/$' | tail -n +11 | xargs -r rm --

echo "тЬЕ р╣Бр╕Ър╕Др╕нр╕▒р╕Юр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М: $BACKUP_DIR/$ZIP_NAME"